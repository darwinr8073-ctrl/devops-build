git config --global user.name "Darwin"

git config --global user.email "darwinr8073@gmail.com"
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


âœ… 1. Clone the project
Bash
Copy code
git clone https://github.com/sriram-R-harshan/devops_build.git
cd devops_build
Run locally once to confirm it works:
Bash
Copy code
npm install
npm start
âœ… 2. Create a Production Dockerfile
Inside the project root:
Dockerfile
Copy code
# Build stage
FROM node:18 AS build
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

# Production stage
FROM nginx:alpine
COPY --from=build /app/build /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
ğŸ‘‰ This builds React â†’ serves with Nginx â†’ runs on port 80.

âœ… 3. Create docker-compose.yml
YAML
Copy code
version: "3.9"

services:
  react-app:
    build: .
    ports:
      - "80:80"
    restart: always
Run locally with:
Bash
Copy code
docker compose up --build
Open â†’ http://localhostï¿½
âœ… 4. Write Bash Scripts
ğŸ”¹ build.sh
Builds Docker image
Bash
Copy code
#!/bin/bash
IMAGE_NAME=$1
docker build -t $IMAGE_NAME .
ğŸ”¹ deploy.sh
Push + run on server
Bash
Copy code
#!/bin/bash
IMAGE_NAME=$1

docker pull $IMAGE_NAME
docker stop react-app || true
docker rm react-app || true
docker run -d -p 80:80 --name react-app $IMAGE_NAME
Make executable:
Bash
Copy code
chmod +x build.sh deploy.sh
âœ… 5. Version Control Setup (CLI only)
Bash
Copy code
git init
echo "node_modules" >> .gitignore
echo "build" >> .gitignore

git add .
git commit -m "Initial production setup"
Create dev branch:
Bash
Copy code
git checkout -b dev
git push origin dev
âœ… 6. Create Repositories on Docker Hub
You need TWO repos:
yourname/react-dev â†’ public
yourname/react-prod â†’ private
Login:
Bash
Copy code
docker login
Build + push DEV image:
Bash
Copy code
docker build -t yourname/react-dev .
docker push yourname/react-dev
Build + push PROD image:
Bash
Copy code
docker build -t yourname/react-prod .
docker push yourname/react-prod
âœ… 7. Deploy on Server (Production)
On server machine:
Bash
Copy code
docker pull yourname/react-prod
docker run -d -p 80:80 yourname/react-prod
App will run on: ğŸ‘‰ http://server-ipï¿½
âœ… 8. What you submit / show
âœ” Running app on port 80
âœ” Dockerfile
âœ” docker-compose.yml
âœ” build.sh & deploy.sh
âœ” Git branches (dev + main)
âœ” Docker Hub dev + prod images

------------------
âœ… 9. Install Jenkins on Server
On your Linux VM (Ubuntu recommended):
Bash
Copy code
sudo apt update
sudo apt install openjdk-17-jdk -y
Install Jenkins:
Bash
Copy code
curl -fsSL https://pkg.jenkins.io/debian-stable/jenkins.io-2023.key | sudo tee \
  /usr/share/keyrings/jenkins-keyring.asc > /dev/null

echo deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] \
  https://pkg.jenkins.io/debian-stable binary/ | sudo tee \
  /etc/apt/sources.list.d/jenkins.list > /dev/null

sudo apt update
sudo apt install jenkins -y
Start Jenkins:
Bash
Copy code
sudo systemctl enable jenkins
sudo systemctl start jenkins
Open in browser: ğŸ‘‰ http://SERVER-IP:8080
Get admin password:
Bash
Copy code
sudo cat /var/lib/jenkins/secrets/initialAdminPassword
Install suggested plugins.
âœ… 10. Install Docker on Same Server
Jenkins must build images.
Bash
Copy code
sudo apt install docker.io -y
sudo usermod -aG docker jenkins
sudo systemctl restart jenkins
Login Docker inside Jenkins machine:
Bash
Copy code
docker login
âœ… 11. Connect Jenkins to GitHub Repo
Inside Jenkins:
1ï¸âƒ£ New Item â†’ Freestyle Project
2ï¸âƒ£ Source Code Management â†’ Git
3ï¸âƒ£ Repo URL â†’ your repo
4ï¸âƒ£ Branches to build:
*/dev
*/main
Enable: âœ” Poll SCM or GitHub webhook trigger
âœ… 12. Jenkins Build Logic (IMPORTANT PART)
In Build Steps â†’ Execute Shell:
Bash
Copy code
#!/bin/bash

REPO_DEV=yourname/react-dev
REPO_PROD=yourname/react-prod

BRANCH=$(git rev-parse --abbrev-ref HEAD)

echo "Branch: $BRANCH"

# Build image
docker build -t app-image .

if [ "$BRANCH" = "dev" ]; then
    docker tag app-image $REPO_DEV
    docker push $REPO_DEV
fi

if [ "$BRANCH" = "main" ]; then
    docker tag app-image $REPO_PROD
    docker push $REPO_PROD

    docker stop react-app || true
    docker rm react-app || true
    docker run -d -p 80:80 --name react-app $REPO_PROD
fi
ğŸ‘‰ What this does:
Push to dev branch â†’ build + push dev image
Merge to main â†’ build + push prod image + deploy
Exactly matches assignment requirement.
âœ… 13. AWS Deployment Setup
Use Amazon Web Services.
Launch server
Create:
Ubuntu instance
t2.micro
Allow ports:
22 (SSH)
80 (HTTP)
8080 (Jenkins)
Security Group rule: âœ” Port 80 â†’ anywhere
âœ” SSH â†’ only your IP
âœ… 14. Deploy App on AWS Automatically
When code merges to main: âœ” Jenkins builds image
âœ” Pushes to prod repo
âœ” Runs container on port 80
Access: ğŸ‘‰ http://EC2-PUBLIC-IP
âœ… 15. Final Flow (How Everything Connects)
Developer push â†’ GitHub â†’ Jenkins â†’ Docker â†’ Server
Dev branch â¡ build image
â¡ push to dev repo
Main branch â¡ build image
â¡ push to prod repo
â¡ deploy container
Thatâ€™s the full CI/CD pipeline.
----------------------
âœ… 16. Setup Monitoring (Health Check)
Goal: check if your deployed app is alive on port 80 and alert only if it goes down.
Option A â€” Simple Open-Source Monitoring (recommended for assignment)
Install Uptime Kuma on your server:
Bash
Copy code
docker run -d \
  --name uptime-kuma \
  -p 3001:3001 \
  louislam/uptime-kuma
Open: ğŸ‘‰ http://SERVER-IP:3001
Setup monitor:
Type â†’ HTTP(s)
URL â†’ http://YOUR-EC2-IP
Interval â†’ 1 minute
Notifications (optional but bonus marks):
Email
Telegram
Discord
This satisfies: âœ” health check
âœ” open-source monitoring
âœ” alert only when down
Option B â€” Bash Health Check (lightweight alternative)
Create healthcheck.sh:
Bash
Copy code
#!/bin/bash

STATUS=$(curl -o /dev/null -s -w "%{http_code}" http://localhost)

if [ "$STATUS" != "200" ]; then
  echo "Application DOWN!"
  # optional: send email or log
fi
Run every minute:
Bash
Copy code
crontab -e
Add:
Copy code

* * * * * /home/ubuntu/healthcheck.sh
âœ… 17. Verify Full Pipeline (Before Submission)
Test these flows:
ğŸ”¹ Dev Branch Push
Push code â†’ dev
Jenkins builds image
Image pushed to dev repo in Docker Hub
No production deployment
ğŸ”¹ Merge to Main
Merge dev â†’ main
Jenkins builds image
Push to prod repo
Container auto-runs on AWS
App available at public IP
âœ… 18. AWS Access Control Requirement
In Amazon Web Services security group:
âœ” Port 80 â†’ open to all
âœ” Port 22 â†’ only your IP
âœ” Jenkins 8080 â†’ only your IP
This matches the requirement: ğŸ‘‰ only you can login
ğŸ‘‰ anyone can access website
âœ… 19. What to Submit
Provide these links:
âœ” GitHub repo URL
âœ” Deployed site URL
âœ” Dev Docker image name
âœ” Prod Docker image name
Upload screenshots of:
1ï¸âƒ£ Jenkins dashboard + build success
2ï¸âƒ£ Jenkins job configuration
3ï¸âƒ£ AWS EC2 instance + security group
4ï¸âƒ£ Running website in browser
5ï¸âƒ£ Docker Hub repos with tags
6ï¸âƒ£ Monitoring dashboard showing â€œUPâ€
Use GitHub repo to upload screenshots.
âœ… 20. Final Architecture (Explain in Viva)
Flow you should describe:
Developer â†’ GitHub â†’ Jenkins â†’ Docker build â†’ Docker Hub â†’ AWS Server â†’ Running Container â†’ Monitoring
Branch logic:
dev â†’ build + push dev image
main â†’ build + push prod image + deploy